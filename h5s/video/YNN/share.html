<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no,address=no,email=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="renderer" content="webkit">
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
	<title>自然力宝宝召集令</title>	
    <link rel="dns-prefetch" href="//res.wx.qq.com">
    <link rel="dns-prefetch" href="//wechat.mgcc.com.cn">
	<link rel="stylesheet" type="text/css" href="./src/css/style.css" />
	<script type="text/javascript" src="./src/js/flexible.js" ></script>
    <script src='http://res.wx.qq.com/open/js/jweixin-1.0.0.js'></script>		
	<script type="text/javascript" src="./src/js/jquery.min.js" ></script>
	<script type="text/javascript" src="./libs/base64.min.js"></script>

	<script type="text/javascript">
		function getQueryString(name) {
		    var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
		    var r = window.location.search.substr(1).match(reg);
		    if (r != null) {
		    return decodeURI(r[2]);
		    }
		    return null;
		}		
		$(function(){
			$('.userimg').attr('src', Base64.decode(getQueryString('imgsrc')));
		})
	</script>
    <script type="text/javascript">
        var mpid = 'a48700ea-fa05-4835-a21a-efbd7c446759';
        var share_pic = 'http://nutricia.mgcc.com.cn/haixuan/src/image/share.png';
        var share_url = 'http://nutricia.mgcc.com.cn/haixuan/share.html?qd=' + getQueryString('qd') + '&imgsrc=' + getQueryString('imgsrc') + "&uid=" + getQueryString('uid');
        var weChatUrlBase = 'http://wechat.mgcc.com.cn/wechat/wxapi/jssdkjsonp?mpid=a48700ea-fa05-4835-a21a-efbd7c446759&callback=1234&callurl=';
        var weChatUrl;
        var sharetitle = "秀出宝宝满满自然力，快来和我家宝宝一起参加《爸爸去哪儿6》的萌娃海选吧";
        var sharedesc = "我家宝宝是" +  getQueryString('uid') + "号萌娃选手";

        function wechatConfig() {
            weChatUrl = weChatUrlBase + location.href.replace(/&/g, '@').split('#')[0];
            $.ajax({
              type: 'get',
              url: weChatUrl,
              dataType: "jsonp",
              crossDomain: !0,
              jsonpCallback: "callbackfn",
              success: function(data) {
                    var config_obj = data;
                    // if (config_obj.status == 1) {
                        if (true){
                            wx.config({
                                debug: false,
                                appId: config_obj.appId,
                                timestamp: config_obj.timestamp,
                                nonceStr: config_obj.nonceStr,
                                signature: config_obj.signature,
                                jsApiList: [
                                    // 所有要调用的 API 都要加到这个列表中
                                    'onMenuShareTimeline',
                                    'onMenuShareAppMessage'
                                ]
                            });
                            wx.ready(function () {
                                wx.onMenuShareAppMessage({
                                    title: sharetitle,
                                    desc: sharedesc,
                                    link: share_url.replace(/\@/g, '#'),
                                    imgUrl: share_pic,
                                    success: function (res) {
                                        //$.get('./race.php?a=share');
                                        // _hmt.push(['_trackEvent', '分享', '点击', '分享给朋友']);
                                    },
                                    cancel: function (res) {
                                    },
                                    fail: function (res) {
                                    }
                                });

                                // 2.2 监听“分享到朋友圈”按钮点击、自定义分享内容及分享结果接口
                                wx.onMenuShareTimeline({
                                    title: sharetitle,
                                    link: share_url.replace(/\@/g, '#'),
                                    imgUrl: share_pic,
                                    success: function (res) {
                                    	// _hmt.push(['_trackEvent', '分享', '点击', '分享到朋友圈']);
                                    },
                                    cancel: function (res) {
                                    },
                                    fail: function (res) {
                                    }
                                });
                            });
                            wx.error(function(res){
                            });
                    } else {
                        console.log('获取分享失败')
                    }

              },
              error:function(xhr, type) {
              }
         });
        }
        wechatConfig();
    </script> 	
	<style type="text/css">
		.userimg {
			width: 5.2rem;
		}
	</style>
</head>
<body>
	<div class="content share">
		<div class="wrap">
			<div class="topimg"></div>
			<div class="result">
				<p>我家宝宝是<span id="J_share_bm_id" >0</span>号萌娃选手</p>
				<script type="text/javascript">
					var id = getQueryString('uid');
					$("#J_share_bm_id").text(id);
				</script>
				<p>你也快来参加吧！</p>
				<div class="wall">
					<img class="userimg" src="" >
				</div>
			</div>
			<div class="btns">
				<a href="javascript:;" onclick="J_jump_()" class="btn btn_share" ></a>
			</div>
		</div>
		<div class="logo-wrap" id="J_logo"></div>
        <script>
        	var qd = getQueryString('qd');
            if(qd == 2){
                $("#J_logo").html('<img src="./src/image/brand_zyyy.png" class="zhongyi">');
            }else{
                $("#J_logo").html('<img src="./src/image/yingbeier.png" class="yingbeier">');
            }
            function J_jump_(){
	            var qd = getQueryString('qd');
	            qd = qd ? qd: 1;
	            location.href = "http://nutricia.mgcc.com.cn/haixuan/?qd=" + qd;
	        }
        </script>
	</div>
	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "https://hm.baidu.com/hm.js?09e76d3a6c3299497ee0a17db092498f";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
	
</body>
</html>