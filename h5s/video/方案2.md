# 视频处理 方案2

方案一IOS和安卓下都使用video实现，在表现上两个系统是有区别的，而且安卓下体验很不好，并且安卓下无法自动播放

### 先说结论：
1. IOS和安卓表现一样
2. IOS和安卓均可以自动播放
3. 解决了黑屏和结束闪频的问题

### 实现
ios 还是使用video 实现
安卓使用jsmpeg.js(ios下使用这种法没有声音具体原因还在不清楚，ios下全屏视频很友好，所有IOS依然使用video实现)
具体实现如下，直接上代码

#### HTML
```html
<!--视频-->
<!--IOS-->
<div class="video-wrapper">
    <video id="video" class="video" style="object-fit:fill" src="video.mp4" preload="auto" x-webkit-airplay="true" playsinline="true" webkit-playsinline="true" x5-video-player-type="h5" x5-video-player-fullscreen="true"></video>        
</div>
<!--安卓-->
<canvas id="canvas" class="warp"></canvas>
```
#### CSS
```css
.video-wrapper {
    width: 100%;
    height: 100%;
    position: absolute;
    margin: auto;
    left: 0;
    top: 0;
    bottom: 0;
    right: 0;
    z-index: 100;
    background: black;            
}
.video-wrapper .video {
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    top: 0;
    z-index: 100;            
}
#canvas {
    width: 100%;
    height: 100%;
    position: absolute;
    margin: auto;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    z-index: 100;
}  
```
#### JS
```js
function iosVideo() {
    // iso 通过监听微信自定义事件WeixinJSBridgeReady可以实现自动播放，安卓不行
    document.getElementById('video').play(); // 在非微信浏览器中播放
    $(document).on('WeixinJSBridgeReady', function() {// 在微信浏览器中播放
        document.getElementById('video').play();
    });    
}
function androidVideo() {
    // 安卓通过另一种方案达到同IOS一样的表现形式
    var canvas, player;
    canvas = document.querySelector('#canvas');
    player = new JSMpeg.Player('out108.ts', {
        canvas: canvas,
        loop: false,
        autoplay: false,
        audio: true
    });
    $(document).on('WeixinJSBridgeReady', function() {
        player.audioOut.unlock(onUnlocked);
    });
    player.audioOut.unlock(onUnlocked);

    function onUnlocked() {
        player.volume = 1;
    }
    player.play();
    player.currentTime = 0;                    
}

// 判断ios或安卓
if (netease.ua.android) {
    androidVideo();
    $('.video-wrapper').remove();
} else if (netease.ua.ios) {
    iosVideo();
}
```
![DEMO](https://songweir.github.io/h5s/video/videots/1525939122.png)
[DEMO](https://songweir.github.io/h5s/video/videots/index.html)

### 解析
这里不对代码做过多的说明，代码都很简单，自行研究，这里主要说下，安卓下实现是如何实现同IOS一样的体验
安卓下的实现主要借助jsmpeg.js
